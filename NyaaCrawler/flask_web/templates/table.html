<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author"      content="Sergey Pozhilov (GetTemplate.com)">

	<title>Magister - Free html5 template by GetTemplate</title>

	<link rel="shortcut icon" href="static/images/gt_favicon.png">

	<!-- Bootstrap itself -->
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet" type="text/css">

	<!-- Custom styles -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/magister.css') }}">
	<!-- Fonts -->
	<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href='http://fonts.googleapis.com/css?family=Wire+One' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker3.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.min.css" />
	<style>
		body {
			overflow:hidden;
		}
		@media (min-width: 1200px) {
			.container{
				width: 1800px;
			}
		}
        .bkcolor{
            background-color: rgba(169, 160, 121, 0.5);
        }

	</style>
</head>

<!-- use "theme-invert" class on bright backgrounds, also try "text-shadows" class -->
<body class="theme-invert">

<nav class="mainmenu">
	<div class="container">
		<div class="dropdown">
			<button type="button" class="navbar-toggle" data-toggle="dropdown"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
			<!-- <a data-toggle="dropdown" href="#">Dropdown trigger</a> -->
			<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				<li><a href="#head" class="active">首頁</a></li>
				<li><a href="#about">資料管理</a></li>
				<li><a href="#themes">爬蟲控制</a></li>
			</ul>
		</div>
	</div>
</nav>


<!-- Main (Home) section -->
<section class="section" id="head">
	<div class="container" class="bkcolor">
        <div class="row">
            <div class="col-sm-2">
                <label for="keyword">文章標題</label>
                  <input type="text" class="form-control" id="keyword">
            </div>
            <div class="col-sm-2">
                <label for="fromDate">發佈日期(起):</label>
                <input type="text" class="form-control" id="fromDate">
            </div>
            <div class="col-sm-2">
                <label for="toDate">發佈日期(起):</label>
                <input type="text" class="form-control" id="toDate">
            </div>
            <div class="col-sm-2">
                <label for="minSize">檔案大小(起):</label>
                <input type="number" class="form-control" id="minSize">
            </div>
            <div class="col-sm-2">
                <label for="maxSize">檔案大小(迄):</label>
                <input type="number" class="form-control" id="maxSize">
            </div>
            <div class="col-sm-2">
                <label for="maxage">最近日期:</label>
                <input type="number" class="form-control" id="maxage">
            </div>
        </div>
        <div class="row">
			<div class="col-sm-1 col-sm-offset-9" class="bkcolor" style="margin-top:10px;margin-bottom:10px">
                <button type="button" id="loadImage" class="btn btn-primary" style="width:120px">載入預覽圖</button>
            </div>
            <div class="col-sm-2 col-sm-offset-0" class="bkcolor" style="margin-top:10px;margin-bottom:10px">
                <button type="button" id="search" class="btn btn-primary" style="width:120px">搜尋</button>
            </div>
        </div>
		<div class="row" class="bkcolor">
			<div class="col-sm-12" class="bkcolor">
				    <table id="table">
					</table>
			</div>

		</div> <!-- /row -->

	</div>

	<div id="previewImage" style="display:none;">
		  <a href="https://c2.staticflickr.com/6/5499/30972532232_051e1dc57e_h.jpg" data-fancybox="0" />

		  <a href="https://farm6.staticflickr.com/5551/31096145856_793c69283a_k_d.jpg" data-fancybox="0"/>

		  <a href="https://c1.staticflickr.com/1/357/31876784275_12286240d4_h.jpg" data-fancybox="1"/>

		  <a href="https://farm3.staticflickr.com/2947/33594572585_b48eba935b_k_d.jpg" data-fancybox="1"/>

	</div>
</section>

<!-- Second (About) section -->
<section class="section" id="about">
	<div class="container">
		<h1>區塊二</h1>
	</div>
</section>

<!-- Third (Works) section -->
<section class="section" id="themes">
	<div class="container">
		<h1>區塊三</h1>
	</div>
</section>

<!-- Load js libs only when the page is loaded. -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!--<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>-->
<script type="text/javascript" src="{{ url_for('static', filename='js/modernizr.custom.72241.js') }}"></script>
<!-- Custom template scripts -->
  <script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <!--<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">-->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
  <script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/magister.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.min.js"></script>

</body>
	<script type='text/javascript'>
		//所有row的資料
		var rowData = {}

		$(document).ready(function() {
			//row的預覽圖按鈕點擊 依照點擊的row的index 開啟不同group的gallery
			 $('#table').on('click', '.fancybox-trigger' , function (event) {
			     var gallery = $("[data-fancybox='" + $(this).attr('trigger-rel') + "']");
			     if(gallery.length>0){
                     gallery.eq(0).trigger('click');
                 }else{
			         swal("沒有預覽圖","", "error")
				 }

             });
             //預載入圖片按鈕點擊
			$('#loadImage').click(function(){

				BuildGallery();
			});
         });

		$('#table').bootstrapTable({
			url:"{{ url_for('get') }}",
			sidePagination:'server',
			height:800,
			method:'get',
			queryParams:function(params){
                 var q = {
                            limit: params.limit,
                            offset: params.offset,
                            keyword : $("#keyword").val(),
                            fromDate : $("#fromDate").val(),
                            toDate : $("#toDate").val(),
                            minSize : $("#minSize").val(),
                            maxSize : $("#maxSize").val(),
                            maxage : $("#maxage").val(),
                            sort : params.sort,
                            search: params.search,
                            order: params.order
                         };

                        return q;
            },
			pageSize:20,
			pagination:true,
			pageList:[10,50,100],
			//當換分頁時 將放預覽圖圖片的div清空
			onPageChange:function(page,size){

			},
			//加載成功時 取得所有row的資料 存到全域變數
			onLoadSuccess:function(data){
			    //從data取得預覽圖位址
				rowData = data.rows
			},
            columns: [
                        {
                            field: "title",
                            title: "標題",
                            sortable: true,
                            width:'30%'
                        },
                        {
                            field: "torrent",
                            title: "種子",
                            sortable: true,
                            width: '5%',
                            formatter:function(value){
                                return '<a href="'+value+'">下載 <i class="fa fa-download" aria-hidden="true"></i></a>'
                            }
                        },
                        {
                            field: "size",
                            title: "檔案大小",
                            sortable: true,
                            width: '5%',
                            formatter:function(value){
                                return value+' MB'
                            }
                        },
                        {
                            field: "articlelink",
                            title: "文章連結",
                            sortable: true,
                            width: '5%',
                            formatter:function(value){
                                return '<a href="'+value+'" target="_blank">文章連結 <i class="fa fa-external-link"></i></a>'
                            }
                        },
                        {
                            field: "ImagePath",
                            title: "預覽圖連結",
                            sortable: true,
                            width: '10%',
                            visible:true,
                            formatter:function(value,row,index){
                                return '<button class="btn btn-primary fancybox-trigger" trigger-rel="'+index+'"> <i class="fa fa-picture-o" aria-hidden="true"></i> 預覽 </button>';
                            }
                        },
                        {
                            field: "pubDate",
                            title: "發佈日期",
                            sortable: true,
                            width: '10%'
                        }
                    ]
		});

		$('#search').click(function () {
                $("#table").bootstrapTable('refresh');
        });

		$('#fromDate,#toDate').datepicker({
            format: "yyyy-mm-dd",
            language: "zh-TW"
        });
		//初始化gallery
		function initFancyBox() {
            $().fancybox({
                selector: '[data-fancybox]',
                thumbs: false,
                hash: false,
            });
        }


		function BuildGallery(){
		    console.log(rowData);
		    if(rowData.length==0)
		        return;

		    rowData.forEach(function(element) {
                console.log(element.ImagePath.url);
            });
		    initFancyBox();
		}
	</script>
</html>